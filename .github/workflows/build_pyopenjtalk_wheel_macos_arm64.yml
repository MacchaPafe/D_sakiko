name: Build pyopenjtalk wheel (macOS arm64, cp311)

on:
  workflow_dispatch:

jobs:
  build:
    name: Build wheel
    runs-on: macos-14

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Upgrade pip
        run: python -m pip install --upgrade pip

      - name: Install build dependencies
        run: |
          python -m pip install --upgrade \
            wheel \
            setuptools \
            'numpy<2.0' \
            'cython>=3' \
            cmake \
            ninja

      - name: Build pyopenjtalk wheel
        env:
          PYOPENJTALK_VERSION: '0.4.1'
          MACOSX_DEPLOYMENT_TARGET: '14.0'
        run: |
          mkdir -p wheels_out
          python -m pip wheel "pyopenjtalk==${PYOPENJTALK_VERSION}" --no-deps -w wheels_out
          ls -lh wheels_out
          shasum -a 256 wheels_out/*.whl | tee wheels_out/SHA256SUMS.txt

      - name: Upload wheel artifacts
        uses: actions/upload-artifact@v4
        with:
          name: pyopenjtalk-cp311-macos-arm64
          path: |
            wheels_out/*.whl
            wheels_out/SHA256SUMS.txt

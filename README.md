2025.6.16

1.功能更新：聊天记录保存

2. 50系显卡用户目前可以用CPU推理，角色可以开口说话了，但是生成速度可能较慢，暂时是治标不治本。关于如何解决50系显卡推理bug，我还在研究中。
   
3. 修复了当仅有括号时会导致程序卡死的bug

v2.0 更新项目：

1.将GPT-SoVITS版本更新为了最新版V4，并重新训练了模型。新版本语音合成的表现有显著的提升，鬼畜或音调失真的情况几乎没有了，电音情况也大幅改善。

2.推出多角色模式！目前包中自带祥子与爱音，但还可以放更多角色，只要按照我定义的文件存放路径以及正确编辑必要文件，可以很方便地自定义角色，程序自动识别，无需修改源码！基本上能看到的元素都可以自定义。如果大伙需要的话，我将另出一期视频讲自定义的事情。（注：GPT-SoVITS模型仅支持V4版本！）

3.语言设置为日语时，增加了同步的中文翻译！

4.祥子礼服加入！当状态为黑祥时将切换为Mujica礼服祥子。

5.用A卡的小伙伴现在可以正常运行程序了，修复了AMD显卡显示不出Live2D界面的bug。但是音频推理仍然只能纯CPU，速度比较慢...这个无解，只能等什么时候ROCm-Pytorch登陆Windows了

6.优化了一些交互逻辑，同时增加了关闭语音合成的选择。另外还有非常多的细节更改。

7.底层运行逻辑几乎重构，现在使用子进程进行音频推理，推理速度大幅提升。相较1.0版本，角色语音回答的速度有显著的加快。另外，更加完善了音频推理准度，还修了很多其他bug，

8.由于更换为了GPT-SoVITS V4模型，显存开销也有了显著的增加，2.0版本的显存占用可能需要至少6G...


数字祥子项目
基于：
1. live2D-py库	https://github.com/Arkueid/live2d-py
2. GPT-SoVITS音色提取合成项目（对一些文件源码进行了改动以适应本项目）	https://github.com/RVC-Boss/GPT-SoVITS
3. Bert-base-Chinese NLP中文预训练模型及OCEMOTION中文七种情感分类数据集，将bert微调为七分类文本情感识别模型
	Bert-base-Chinese：https://huggingface.co/google-bert/bert-base-chinese 	OCEMOTION：https://aistudio.baidu.com/datasetdetail/100731

4.Deepseek V3 在线API调用，以及PyQT5前端界面

感谢大佬们的库，调库侠泪流满面...

开箱即用，双击run.bat即可打开程序，无需安装任何依赖~（代价就是所有库都塞了进去，解压后的文件夹比较大...）

*推荐带N卡的机器运行，显存需要4G左右，运行时有很多模型需要加载。纯CPU的话也能跑，但速度会很慢。

*除了视频中最重要的语音输出聊天的功能外，还有一些小细节功能，比如点击画面可以让祥子随机做动作等

*可以非常简单的更换背景：将想更换的背景图片放入live2d_related文件夹中即可。

*对于很多可能会说呲的词语进行了替换，有的不违和，比如日语模式中将人名汉字全部标了音，对CRYCHIC、Ave Mujica等不容易读对的英语单词替换为假名，这些效果都不错。但有的实在没办法，比如CRYCHIC中文模式下一定乱读，替换为了C团（不太好，但想不出别的替换词了）。


***由于GPT-SoVITS默认为半精度浮点(fp16)量化推理，但经过实验在compute capability<=7.5，也就是包括16系之前的显卡有可能出bug推理出无声音频，导致程序崩溃。具体原因应该非常底层，估计是NV驱动的问题，所以个人无法解决。因此我修改了inference_webui.py中的is_half变量，使用单精度浮点(fp32)量化模型来推理音频，这一操作的好处是所有显卡都能跑，程序应该不会崩，并且实测推理出的音频质量也会更好一点，而副作用就是推理时间更长，显存占用更大。因此综上，我设置了is_fp32.txt文件，默认里面是一个数字1，表示使用fp32来推理音频，兼容性最好、质量较高，但推理速度变慢；若改为0，则使用GPT-SoVITS的默认策略fp16量化模型，推理时间会缩短一点，祥子的回答会快一些，但注意：如果显卡型号小于等于1660ti，很有可能听不到祥子语音，最好确保大于等于RTX 2060！

针对自定义角色有优化，只需对应文件夹中的元素（如Live2D模型、GPT与SoVITS模型、人物介绍等）替换为其他角色的即可。大火如果有兴趣会再做一个视频讲怎么自定义角色。

目前最大的问题就是性能，由于全都是Python写的，首先是语音合成比较慢，通常要等十余秒（2080ti的成绩）才能有声音输出，比较降低体验...更新更强的N卡可能会加快速度。该问题很难解决，是GPT-SoVITS项目的特性决定的，它并不是为实时输出音频而设计，而是以输出质量为优先，调用了很多模型，数据预处理也非常复杂。

另外Live2D界面的帧率也不高，我自己的3800X算出来只有不到30帧...经测试非常依赖CPU单核性能。该问题在Arkueid大佬编写的live2D-py库中也有涉及，因为祥子的Live2D模型是旧版本（.moc格式，实际上邦邦所有角色都是旧模型），而live2D-py库没有针对旧版本模型进行优化，只对新版本（.moc3）有调用c语言源码库。也许换成新版本模型性能就会大幅提升，但目前暂未测试。因此目前只是一个初版，后续的性能优化是最重点的工作。

目前正在挂到github上... https://github.com/MacchaPafe/D_sakiko


作者：要抹茶要乐奈   b站：https://space.bilibili.com/443409863?spm_id_from=333.1007.0.0

